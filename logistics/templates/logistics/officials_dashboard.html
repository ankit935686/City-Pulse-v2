{% extends 'users/base.html' %}

{% block title %}Officials' Dashboard - CityPulse{% endblock %}

{% block content %}
<div class="officials-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">
                <i class="ri-government-line"></i>
                Officials' Dashboard
            </h1>
            <p class="dashboard-subtitle">
                Advanced analytics and insights for infrastructure project management
            </p>
        </div>
        <div class="header-actions">
            <a href="{% url 'projects_overview' %}" class="btn btn-outline-primary">
                <i class="ri-arrow-left-line"></i>
                Back to Projects Overview
            </a>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Trends Analysis Card -->
        <div class="dashboard-card trends-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="ri-line-chart-line"></i>
                </div>
                <h3>Trends Analysis</h3>
            </div>
            <div class="card-content">
                <p>Comprehensive analytics on project completion trends, delays, and infrastructure growth patterns over time.</p>
                <div class="card-features">
                    <span class="feature-tag">Completion Trends</span>
                    <span class="feature-tag">Delay Analysis</span>
                    <span class="feature-tag">Growth Heatmaps</span>
                </div>
            </div>
            <div class="card-actions">
                <a href="{% url 'trends_analysis' %}" class="btn btn-primary">
                    View Trends
                    <i class="ri-arrow-right-line"></i>
                </a>
            </div>
        </div>

        <!-- Bottlenecks Card -->
        <div class="dashboard-card bottlenecks-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="ri-error-warning-line"></i>
                </div>
                <h3>Bottlenecks & Issues</h3>
            </div>
            <div class="card-content">
                <p>Identify and analyze project bottlenecks, overlapping areas, and critical issues affecting infrastructure development.</p>
                <div class="card-features">
                    <span class="feature-tag">Issue Tracking</span>
                    <span class="feature-tag">Overlap Detection</span>
                    <span class="feature-tag">Priority Management</span>
                </div>
            </div>
            <div class="card-actions">
                <a href="{% url 'bottlenecks_view' %}" class="btn btn-primary">
                    View Bottlenecks
                    <i class="ri-arrow-right-line"></i>
                </a>
            </div>
        </div>

        <!-- Road Development Analytics Card -->
        <div class="dashboard-card road-analytics-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="ri-road-map-line"></i>
                </div>
                <h3>Road Development Analytics</h3>
            </div>
            <div class="card-content">
                <p>Comprehensive analysis of road infrastructure planning, budget efficiency, and development insights across cities.</p>
                <div class="card-features">
                    <span class="feature-tag">Budget Analysis</span>
                    <span class="feature-tag">Efficiency Metrics</span>
                    <span class="feature-tag">City-wise Insights</span>
                </div>
            </div>
            <div class="card-actions">
                <a href="{% url 'road_development_analytics' %}" class="btn btn-primary">
                    View Analytics
                    <i class="ri-arrow-right-line"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <div class="stats-header">
            <h3>Quick Overview</h3>
            <p>Key metrics at a glance</p>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-icon projects">
                    <i class="ri-folder-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h4>Total Projects</h4>
                    <span class="stat-value" id="totalProjects">-</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon issues">
                    <i class="ri-alert-line"></i>
                </div>
                <div class="stat-content">
                    <h4>Active Issues</h4>
                    <span class="stat-value" id="activeIssues">-</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon budget">
                    <i class="ri-money-dollar-circle-line"></i>
                </div>
                <div class="stat-content">
                    <h4>Avg Budget/Project</h4>
                    <span class="stat-value" id="avgDelay">-</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon completion">
                    <i class="ri-check-line"></i>
                </div>
                <div class="stat-content">
                    <h4>Completion Rate</h4>
                    <span class="stat-value" id="completionRate">-</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.officials-dashboard {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
    padding: 2.5rem 3rem;
    background: linear-gradient(135deg, var(--purple-600), var(--purple-500));
    border-radius: 1.25rem;
    color: white;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
}

.header-content h1 {
    font-size: 2.75rem;
    font-weight: 800;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    letter-spacing: -0.5px;
}

.header-content p {
    font-size: 1.2rem;
    opacity: 0.95;
    margin: 0;
    max-width: 600px;
}

.btn-outline-primary {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.875rem 1.75rem;
    border-radius: 1rem;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
    font-weight: 600;
}

.btn-outline-primary:hover {
    background: white;
    color: var(--purple-600);
    transform: translateY(-2px);
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 3rem;
}

.dashboard-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 1.25rem;
    padding: 2.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
}

.card-header {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    margin-bottom: 2rem;
}

.card-icon {
    width: 68px;
    height: 68px;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    color: white;
    flex-shrink: 0;
}

.card-header h3 {
    font-size: 1.625rem;
    font-weight: 700;
    margin: 0;
    color: var(--foreground);
    line-height: 1.3;
}

.card-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.card-content p {
    color: var(--secondary-foreground);
    margin-bottom: 1.75rem;
    line-height: 1.7;
    font-size: 1.05rem;
}

.card-features {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 2rem;
}

.feature-tag {
    background: var(--secondary);
    color: var(--secondary-foreground);
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.feature-tag:hover {
    background: var(--purple-100);
    color: var(--purple-600);
}

.card-actions {
    margin-top: auto;
}

.card-actions .btn {
    width: 100%;
    justify-content: center;
    padding: 1.125rem;
    font-weight: 600;
    border-radius: 1rem;
    transition: all 0.3s ease;
    gap: 0.75rem;
}

.quick-stats {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 1.25rem;
    padding: 2.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
}

.stats-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.stats-header h3 {
    font-size: 1.875rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--foreground);
}

.stats-header p {
    color: var(--secondary-foreground);
    margin: 0;
    font-size: 1.125rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2rem;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    padding: 1.75rem;
    background: var(--background);
    border-radius: 1rem;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
}

.stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 1rem;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.stat-icon.projects {
    background: var(--blue-600, #2563eb);
}

.stat-icon.issues {
    background: var(--red-600, #dc2626);
}

.stat-icon.budget {
    background: var(--green-600, #16a34a);
}

.stat-icon.completion {
    background: var(--purple-600, #9333ea);
}

.stat-content h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--secondary-foreground);
    margin: 0 0 0.375rem 0;
}

.stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--foreground);
    line-height: 1.2;
}

@media (max-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .officials-dashboard {
        padding: 1rem;
    }
    
    .dashboard-header {
        flex-direction: column;
        text-align: center;
        padding: 2rem;
        gap: 1.5rem;
    }
    
    .header-content h1 {
        font-size: 2.25rem;
        justify-content: center;
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-item {
        padding: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load quick stats
    loadQuickStats();
});

async function loadQuickStats() {
    try {
        // Load projects data for basic stats
        const projectsResponse = await fetch('/logistics/api/projects/');
        const projectsData = await projectsResponse.json();
        
        if (projectsData.success) {
            const projects = projectsData.data;
            const totalProjects = projects.length;
            const completedProjects = projects.filter(p => p.status === 'Completed').length;
            const delayedProjects = projects.filter(p => p.status === 'Delayed').length;
            
            // Calculate completion rate
            const completionRate = totalProjects > 0 ? Math.round((completedProjects / totalProjects) * 100) : 0;
            
            // Update stats
            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('completionRate').textContent = completionRate + '%';
            
            // Load bottlenecks for active issues
            const bottlenecksResponse = await fetch('/logistics/api/bottlenecks/');
            const bottlenecksData = await bottlenecksResponse.json();
            
            if (bottlenecksData.success) {
                const activeIssues = bottlenecksData.data.bottlenecks.filter(b => 
                    b.status === 'Open' || b.status === 'In Progress'
                ).length;
                document.getElementById('activeIssues').textContent = activeIssues;
            }
            
            // Load road development data for average delay
            const roadDevResponse = await fetch('/logistics/api/road-development/');
            const roadDevData = await roadDevResponse.json();
            
            if (roadDevData.success) {
                const avgDelay = Math.round(roadDevData.data.total_budget / roadDevData.data.total_projects);
                document.getElementById('avgDelay').textContent = 'â‚¹' + avgDelay + ' Cr';
            }
        }
    } catch (error) {
        console.error('Error loading quick stats:', error);
    }
}
</script>
{% endblock %}
